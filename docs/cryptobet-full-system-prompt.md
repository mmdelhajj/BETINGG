# ðŸš€ CRYPTOBET â€” COMPLETE PLATFORM CLONE (Cloudbet-Style)
# Claude Code Multi-Agent Prompt â€” FULL SYSTEM

---

## ðŸ“‹ COMPLETE CLOUDBET FEATURE MAP (Everything Found)

### ðŸ’° PAYMENT SYSTEM (Full Details)
**40+ Cryptocurrencies Supported:**
- **Major**: BTC, ETH, LTC, BCH, USDT, USDC, BNB, DOGE, XRP
- **DeFi**: DAI, LINK, UNI, AAVE, COMP, SUSHI, YFI, MKR
- **Layer 2**: MATIC, SOL, ADA, DOT, AVAX, ATOM, FTM, NEAR, APT
- **Meme**: SHIB, PEPE, FLOKI
- **Others**: TRX, XLM, EOS, ALGO, TON, DASH

**Blockchain Networks Supported:**
- Ethereum Mainnet, BNB Smart Chain, Avalanche, Solana, Polygon, Tron, TON (The Open Network)

**Fiat On-Ramp (Buy Crypto On-Site):**
- **MoonPay Integration**: Visa, Mastercard, ApplePay, GooglePay â†’ Buy crypto directly
- **Swapped Integration**: AstroPay, Skrill, Neteller, PIX (Brazil), UPI (India), GoPay, GCash, Maya, Paysafecard, PromptPay, Blik, Rapid Transfer
- 150+ countries, 40+ local payment methods
- Purchase limits: â‚¬5,000/24h, â‚¬20,000/month via MoonPay

**Deposit System:**
- No minimum deposit (any amount accepted)
- No maximum deposit limit
- No fees charged by platform
- Instant crediting upon blockchain confirmation
- QR code + address copy for crypto deposits
- "Missing deposit?" recovery system
- Multi-chain deposit detection (same token, different chains)
- Auto-detection of incoming transactions

**Withdrawal System:**
- Minimum varies by crypto (BTC: 0.0001, ETH: 0.001, USDT: 1)
- Small blockchain network fee (passed through, not platform profit)
- Processing: minutes to 24 hours
- KYC-gated limits: unverified = â‚¬2,200/day, verified = unlimited
- Approval queue for large withdrawals
- Address whitelist option

**Platform Wallet Architecture:**
- Hot wallet: For active betting/gaming balances
- Cold storage: Multi-sig for bulk funds (security)
- Per-user wallet addresses generated per currency
- Internal currency switching (swap between cryptos)
- Balance display in any fiat equivalent (USD, EUR, etc.)

**Ledger/External Wallet Connectivity:**
- Users connect Ledger, MetaMask, Trust Wallet, Coinbase Wallet
- WalletConnect protocol support
- Direct deposit from hardware wallet
- One-click withdrawal to connected wallet

---

### ðŸ† REWARDS PROGRAM (Complete Breakdown)

**Welcome Package ($2,500 over 30 days):**
- Activates on first deposit
- 10% rakeback on every bet from day 1
- Daily cash drops based on activity
- Cash Vault: final mega bonus on day 30
- All rewards = real cash, ZERO rollover/wagering requirements
- Paid as USDT to wallet

**Rakeback System (Core Engine):**
- Every bet earns % of house edge as rakeback
- Split: portion â†’ wallet immediately, portion â†’ Rewards Calendar
- Rakeback % increases with VIP tier
- Sportsbook + Casino both earn rakeback
- Accumulated rakeback claimed via "Add" button

**Rewards Calendar:**
- Unlocks 3 times per day (every 8 hours)
- 12-hour claim window per unlock
- Contains: daily rewards, weekly rewards, monthly rewards
- Rewards calculated from: lossback + rakeback + VIP tier
- Visual calendar UI showing pending/claimed rewards

**TURBO Mode:**
- Activates automatically when claiming any calendar reward
- Boosts casino rakeback up to 25% temporarily
- Duration: up to 90 minutes at highest VIP tiers
- Timer countdown visible in UI
- Higher VIP tier = bigger boost + longer duration

**Level-Up Rewards:**
- Cash bonus for crossing wagering thresholds
- Progressive levels within each VIP tier
- Highest tiers: up to $2.5M in cumulative level-up rewards
- Split to wallet + calendar like rakeback

**VIP Tier System (8 Tiers):**
| Tier | Benefits |
|------|----------|
| Bronze | Base rakeback, daily cash rewards, turbo boost, level-up rewards |
| Silver | + Weekly cash rewards, global tournament access, tier-up bonus |
| Gold | + Monthly cash rewards, bigger level-up payouts, higher rakeback |
| Emerald | + Enhanced everything, exclusive promotions |
| Sapphire | + Priority support, higher limits |
| Ruby | + Bespoke rewards, real-world experiences |
| Diamond | + Dedicated VIP concierge 24/7, money-can't-buy experiences |
| Blue Diamond | + Maximum rakeback (~25%), top-tier everything, private terms |

**Referral Program:**
- Unique referral link per user
- Earn when referred friends play
- Minimum play requirement (anti-fraud)
- Referral tracking dashboard
- Tiered rewards based on referee activity

**Promotions:**
- Weekend Bet Builder draws with cash prizes
- Drops & Wins (provider tournaments)
- Odds boosts on select crypto bets
- Seasonal/event-based promos (Super Bowl, World Cup, etc.)
- Promo code system

---

### ðŸŽ® ADMIN DASHBOARD (What Admin Controls)

**User Management:**
- Search/filter users by email, username, VIP tier, balance
- View full user profile, bet history, transactions
- Manual balance adjustment (credit/debit)
- Ban/suspend/restrict accounts
- KYC document review queue (approve/reject)
- Set individual bet limits
- Force password reset, disable 2FA

**Payment Management (FROM DASHBOARD):**
- **Add/Remove Cryptocurrencies**: Enable/disable any coin from dashboard
- **Configure Blockchain Networks**: Add/remove supported chains per token
- **Set Deposit/Withdrawal Limits**: Per currency, per KYC level
- **Set Network Fees**: Configure withdrawal fees per blockchain
- **Approve Large Withdrawals**: Manual approval queue for big amounts
- **Connect to Ledger/Cold Storage**: Link admin cold storage wallets
- **Hot Wallet Management**: Monitor hot wallet balances, set thresholds for auto-refill from cold storage
- **Fiat On-Ramp Config**: Enable/disable MoonPay, Swapped, set limits
- **Transaction Monitoring**: Real-time feed of all deposits/withdrawals
- **Wallet Address Generation**: Generate new deposit addresses on demand
- **Currency Exchange Rates**: Manual or API-fed exchange rate management
- **Payment Provider Settings**: API keys for MoonPay, Swapped, blockchain RPCs

**Sportsbook Management:**
- CRUD sports, leagues, competitions
- Create/edit/cancel events
- Update live scores manually
- Create markets and set odds
- Settle markets (win/loss/void)
- Suspend markets during live events
- Configure odds margins per sport/league
- Set min/max bet limits per market
- View open liability per event

**Casino Management:**
- Enable/disable games and providers
- Set RTP configuration
- Configure house edge per game type
- Manage provably fair seeds
- View revenue per game
- Popular games analytics

**Rewards Management (FROM DASHBOARD):**
- **Configure VIP Tiers**: Set thresholds, rakeback %, bonuses per tier
- **Rakeback Settings**: Global rakeback percentages, split ratios (wallet vs calendar)
- **TURBO Configuration**: Boost %, duration per tier
- **Welcome Package**: Set rewards amounts, 30-day schedule, Cash Vault amount
- **Create Promotions**: Deposit bonus, free bets, odds boost, cashback, tournaments
- **Promo Conditions**: Min odds, min stake, eligible sports/games, time windows
- **Manage Promo Codes**: Generate, activate, deactivate, set limits
- **Level-Up Thresholds**: Configure wagering milestones and rewards
- **Manual Bonus Granting**: Give specific user a custom bonus
- **Referral Program Settings**: Commission %, minimum play requirements

**Financial Reports:**
- Daily/weekly/monthly P&L
- Revenue per sport, per casino game, per user segment
- Deposit/withdrawal volume charts
- Outstanding liabilities
- House edge tracking
- Currency-wise balance sheet
- Affiliate commission reports

**Risk Management:**
- Large bet alerts (configurable threshold)
- Unusual betting pattern detection
- Liability exposure per event/market
- User win-rate monitoring
- Duplicate account detection
- Geo-restriction management

**Site Settings:**
- Languages management (19 languages like Cloudbet)
- Theme configuration
- Terms of service, privacy policy
- Responsible gambling settings
- Maintenance mode toggle
- API rate limits configuration

---

## ðŸ¤– CLAUDE CODE MULTI-AGENT PROMPT (8 AGENTS â€” FULL SYSTEM)

Copy everything below into Claude Code:

```
# CRYPTOBET â€” FULL CRYPTO SPORTSBOOK + CASINO PLATFORM
# Multi-Agent Build with 8 Specialized Agents
# Clone of Cloudbet with ALL features

You are orchestrating 8 specialized AI agents to build a production-grade crypto betting platform. This is a COMPLETE system â€” every feature must be implemented including full payment management from admin dashboard, external wallet (Ledger/MetaMask) connectivity, and the complete rewards/VIP engine.

## TECH STACK
- **Frontend**: Next.js 14 (App Router), TypeScript, Tailwind CSS, shadcn/ui, Framer Motion, Zustand
- **Backend**: Node.js with Fastify, TypeScript
- **Database**: PostgreSQL (Prisma ORM)
- **Cache/Realtime**: Redis (caching, sessions, pub/sub, live odds)
- **Queue**: BullMQ (bet processing, settlement, rewards, notifications, withdrawals)
- **Real-time**: Socket.IO (live odds, live scores, crash game, notifications)
- **Crypto**: ethers.js (EVM chains), bitcoinjs-lib (BTC), @solana/web3.js (SOL)
- **Auth**: JWT + OAuth2 (Google, GitHub) + TOTP 2FA
- **API**: REST (versioned) + GraphQL (Apollo Server)
- **Containerization**: Docker + Docker Compose + Nginx
- **Testing**: Vitest + Playwright

---

## AGENT 1: DATABASE ARCHITECT & CORE INFRASTRUCTURE

### Database Schema (Prisma)
Design and implement every table:

**Users & Auth:**
```prisma
model User {
  id              String    @id @default(cuid())
  email           String    @unique
  username        String    @unique
  passwordHash    String
  avatar          String?
  dateOfBirth     DateTime?
  kycLevel        KycLevel  @default(UNVERIFIED)   // UNVERIFIED, BASIC, FULL
  vipTier         VipTier   @default(BRONZE)        // BRONZE -> BLUE_DIAMOND
  totalWagered    Decimal   @default(0)             // lifetime wager for VIP progression
  twoFactorSecret String?
  twoFactorEnabled Boolean  @default(false)
  preferredCurrency String  @default("USDT")
  preferredOddsFormat OddsFormat @default(DECIMAL)  // DECIMAL, FRACTIONAL, AMERICAN
  theme           Theme     @default(DARK)          // DARK, LIGHT, CLASSIC
  language        String    @default("en")
  isActive        Boolean   @default(true)
  isBanned        Boolean   @default(false)
  banReason       String?
  depositLimit    Json?     // { daily: 1000, weekly: 5000, monthly: 20000 }
  lossLimit       Json?
  selfExcludedUntil DateTime?
  timeoutUntil    DateTime?
  referralCode    String    @unique @default(cuid())
  referredBy      String?
  lastLoginAt     DateTime?
  lastLoginIp     String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  wallets         Wallet[]
  bets            Bet[]
  casinoSessions  CasinoSession[]
  rewards         Reward[]
  notifications   Notification[]
  kycDocuments    KycDocument[]
  referrals       Referral[]     @relation("Referrer")
  referredUsers   Referral[]     @relation("Referred")
  auditLogs       AuditLog[]
  apiKeys         ApiKey[]
}
```

**Payment & Wallet System:**
```prisma
model Currency {
  id              String   @id @default(cuid())
  symbol          String   @unique    // BTC, ETH, USDT, etc.
  name            String               // Bitcoin, Ethereum, etc.
  type            CurrencyType         // CRYPTO, FIAT, STABLECOIN
  decimals        Int                  // 8 for BTC, 18 for ETH
  icon            String?
  isActive        Boolean  @default(true)
  isDepositEnabled Boolean @default(true)
  isWithdrawEnabled Boolean @default(true)
  minWithdrawal   Decimal
  withdrawalFee   Decimal              // network fee
  exchangeRateUsd Decimal              // current USD rate
  sortOrder       Int      @default(0)
  createdAt       DateTime @default(now())
  
  networks        CurrencyNetwork[]
  wallets         Wallet[]
}

model CurrencyNetwork {
  id              String   @id @default(cuid())
  currencyId      String
  currency        Currency @relation(fields: [currencyId])
  networkName     String               // ethereum-mainnet, bsc, tron, solana, etc.
  networkLabel    String               // "ERC-20", "BEP-20", "TRC-20", "SPL"
  contractAddress String?              // token contract (null for native coins)
  confirmations   Int      @default(1) // required confirmations
  isActive        Boolean  @default(true)
  estimatedTime   String?              // "~5 minutes"
  rpcUrl          String?              // blockchain RPC endpoint
  explorerUrl     String?              // block explorer base URL
}

model Wallet {
  id              String   @id @default(cuid())
  userId          String
  user            User     @relation(fields: [userId])
  currencyId      String
  currency        Currency @relation(fields: [currencyId])
  balance         Decimal  @default(0)   // available balance
  lockedBalance   Decimal  @default(0)   // in pending bets/withdrawals
  bonusBalance    Decimal  @default(0)   // bonus funds
  depositAddress  String?               // unique per user per currency
  networkId       String?               // which network for this address
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  transactions    Transaction[]
  @@unique([userId, currencyId])
}

model Transaction {
  id              String   @id @default(cuid())
  walletId        String
  wallet          Wallet   @relation(fields: [walletId])
  type            TxType   // DEPOSIT, WITHDRAWAL, BET, WIN, BONUS, RAKEBACK, REWARD, REFERRAL, ADJUSTMENT, SWAP
  amount          Decimal
  fee             Decimal  @default(0)
  txHash          String?              // blockchain tx hash
  fromAddress     String?
  toAddress       String?
  networkId       String?
  status          TxStatus @default(PENDING) // PENDING, CONFIRMING, COMPLETED, FAILED, CANCELLED, APPROVED, REJECTED
  confirmations   Int      @default(0)
  approvedBy      String?              // admin who approved (for withdrawals)
  metadata        Json?                // extra data
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model FiatOnRampProvider {
  id              String   @id @default(cuid())
  name            String   // MoonPay, Swapped
  apiKey          String   // encrypted
  secretKey       String?  // encrypted
  webhookSecret   String?
  isActive        Boolean  @default(true)
  supportedFiats  Json     // ["USD", "EUR", "GBP", ...]
  supportedCryptos Json    // ["BTC", "ETH", "USDT", ...]
  dailyLimit      Decimal?
  monthlyLimit    Decimal?
  feePercent      Decimal?
  config          Json?    // provider-specific config
}

model AdminWallet {
  id              String   @id @default(cuid())
  label           String   // "Hot Wallet - BTC", "Cold Storage - ETH"
  type            AdminWalletType // HOT, COLD, MULTISIG
  currencySymbol  String
  address         String
  network         String
  balance         Decimal  @default(0)
  minThreshold    Decimal? // auto-refill from cold when below this
  maxThreshold    Decimal? // sweep to cold when above this
  isActive        Boolean  @default(true)
  lastSyncAt      DateTime?
  createdAt       DateTime @default(now())
}
```

**Sportsbook:**
```prisma
model Sport {
  id          String   @id @default(cuid())
  name        String   @unique
  slug        String   @unique
  icon        String?
  isActive    Boolean  @default(true)
  sortOrder   Int      @default(0)
  competitions Competition[]
}

model Competition {
  id          String   @id @default(cuid())
  sportId     String
  sport       Sport    @relation(fields: [sportId])
  name        String
  country     String?
  slug        String
  isActive    Boolean  @default(true)
  events      Event[]
  @@unique([sportId, slug])
}

model Event {
  id            String      @id @default(cuid())
  competitionId String
  competition   Competition @relation(fields: [competitionId])
  name          String
  homeTeam      String?
  awayTeam      String?
  startTime     DateTime
  status        EventStatus @default(UPCOMING) // UPCOMING, LIVE, ENDED, CANCELLED, POSTPONED
  scores        Json?       // { home: 2, away: 1, periods: [...] }
  metadata      Json?       // stats, commentary, etc.
  isLive        Boolean     @default(false)
  isFeatured    Boolean     @default(false)
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  markets       Market[]
}

model Market {
  id          String   @id @default(cuid())
  eventId     String
  event       Event    @relation(fields: [eventId])
  name        String   // "Match Winner", "Over/Under 2.5", etc.
  marketKey   String   // "match_odds", "total_goals", "asian_handicap"
  type        MarketType // MONEYLINE, SPREAD, TOTAL, PROP, OUTRIGHT
  period      String   @default("FT") // FT, HT, 1Q, 2Q, etc.
  status      MarketStatus @default(OPEN) // OPEN, SUSPENDED, SETTLED, CANCELLED, VOIDED
  sortOrder   Int      @default(0)
  selections  Selection[]
}

model Selection {
  id          String   @id @default(cuid())
  marketId    String
  market      Market   @relation(fields: [marketId])
  name        String   // "Home", "Away", "Draw", "Over 2.5"
  outcome     String   // "home", "away", "draw", "over", "under"
  odds        Decimal  // current decimal odds
  probability Decimal? // implied probability
  maxStake    Decimal? // max allowed bet
  handicap    Decimal? // for spread/handicap markets
  params      String?  // additional parameters
  status      SelectionStatus @default(ACTIVE) // ACTIVE, SUSPENDED, WON, LOST, VOID, PUSH
  result      SelectionResult? // WIN, LOSE, VOID, PUSH, HALF_WIN, HALF_LOSE
  betLegs     BetLeg[]
}
```

**Betting System:**
```prisma
model Bet {
  id            String    @id @default(cuid())
  userId        String
  user          User      @relation(fields: [userId])
  referenceId   String    @unique @default(uuid()) // for API tracking
  type          BetType   // SINGLE, PARLAY, SYSTEM
  stake         Decimal
  currencySymbol String
  potentialWin  Decimal
  actualWin     Decimal?
  cashoutAmount Decimal?
  cashoutAt     DateTime?
  odds          Decimal   // combined odds for parlays
  status        BetStatus @default(PENDING) // PENDING, ACCEPTED, WON, LOST, VOID, CASHOUT, PARTIALLY_SETTLED
  settledAt     DateTime?
  isLive        Boolean   @default(false)
  isCashoutAvailable Boolean @default(false)
  placedVia     String    @default("WEB") // WEB, MOBILE, API
  ipAddress     String?
  createdAt     DateTime  @default(now())
  legs          BetLeg[]
}

model BetLeg {
  id              String    @id @default(cuid())
  betId           String
  bet             Bet       @relation(fields: [betId])
  selectionId     String
  selection       Selection @relation(fields: [selectionId])
  oddsAtPlacement Decimal
  status          BetLegStatus @default(PENDING) // PENDING, WON, LOST, VOID, PUSH, HALF_WIN, HALF_LOSE
}
```

**Casino:**
```prisma
model CasinoGame {
  id          String   @id @default(cuid())
  providerId  String?
  provider    GameProvider? @relation(fields: [providerId])
  name        String
  slug        String   @unique
  type        GameType // SLOT, TABLE, LIVE, CRASH, DICE, COINFLIP, MINES, PLINKO, VIRTUAL
  category    String?  // "popular", "new", "jackpot"
  rtp         Decimal? // return to player %
  volatility  String?  // LOW, MEDIUM, HIGH
  houseEdge   Decimal? // %
  thumbnail   String?
  description String?
  tags        String[] // ["provably-fair", "jackpot", "bonus-buy"]
  isActive    Boolean  @default(true)
  isDemoAvailable Boolean @default(true)
  isProvablyFair Boolean @default(false)
  launchUrl   String?  // for external provider games
  sortOrder   Int      @default(0)
  playCount   Int      @default(0) // for popularity sorting
  sessions    CasinoSession[]
}

model GameProvider {
  id       String       @id @default(cuid())
  name     String       @unique // NetEnt, Microgaming, Evolution, etc.
  slug     String       @unique
  logo     String?
  apiUrl   String?
  apiKey   String?      // encrypted
  isActive Boolean      @default(true)
  games    CasinoGame[]
}

model CasinoSession {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId])
  gameId      String
  game        CasinoGame @relation(fields: [gameId])
  currency    String
  totalBet    Decimal  @default(0)
  totalWin    Decimal  @default(0)
  rounds      Int      @default(0)
  serverSeed  String?
  clientSeed  String?
  nonce       Int?
  startedAt   DateTime @default(now())
  endedAt     DateTime?
}

model ProvablyFairSeed {
  id              String  @id @default(cuid())
  userId          String
  serverSeed      String  // hashed and shown before reveal
  serverSeedHash  String  // SHA-256 hash shown to user
  clientSeed      String
  nonce           Int     @default(0)
  isRevealed      Boolean @default(false)
  revealedAt      DateTime?
  createdAt       DateTime @default(now())
}
```

**Rewards & VIP:**
```prisma
model VipTierConfig {
  id              String  @id @default(cuid())
  tier            VipTier @unique
  name            String  // "Bronze", "Silver", etc.
  minWagered      Decimal // threshold to reach this tier
  rakebackPercent Decimal // base rakeback %
  turboBoostPercent Decimal // turbo mode boost %
  turboDurationMin Int     // turbo duration in minutes
  dailyBonusMax   Decimal
  weeklyBonusMax  Decimal?
  monthlyBonusMax Decimal?
  levelUpReward   Decimal
  calendarSplitPercent Decimal // % of rakeback going to calendar vs wallet
  maxLevelUpReward Decimal?  // lifetime cap
  sortOrder       Int
  benefits        Json    // { description: [...], perks: [...] }
}

model Reward {
  id          String     @id @default(cuid())
  userId      String
  user        User       @relation(fields: [userId])
  type        RewardType // RAKEBACK, DAILY, WEEKLY, MONTHLY, LEVEL_UP, TURBO, WELCOME, CASH_VAULT, REFERRAL
  amount      Decimal
  currency    String     @default("USDT")
  source      String?    // which bet/activity generated this
  status      RewardStatus @default(PENDING) // PENDING, CLAIMABLE, CLAIMED, EXPIRED
  claimableAt DateTime?
  expiresAt   DateTime?
  claimedAt   DateTime?
  calendarDay Int?       // day number in rewards calendar
  calendarSlot Int?      // 1, 2, or 3 (3 claims per day)
  createdAt   DateTime   @default(now())
}

model TurboSession {
  id          String   @id @default(cuid())
  userId      String
  boostPercent Decimal
  startedAt   DateTime @default(now())
  endsAt      DateTime
  isActive    Boolean  @default(true)
}

model WelcomePackage {
  id              String   @id @default(cuid())
  userId          String   @unique
  activatedAt     DateTime @default(now())
  expiresAt       DateTime // 30 days after activation
  totalEarned     Decimal  @default(0)
  maxReward       Decimal  @default(2500) // $2,500 cap
  rakebackPercent Decimal  @default(10)   // 10% during welcome
  dailyDropsClaimed Int    @default(0)
  cashVaultAmount Decimal  @default(0)    // accumulated for day 30
  cashVaultClaimed Boolean @default(false)
  isActive        Boolean  @default(true)
}

model Promotion {
  id          String   @id @default(cuid())
  title       String
  description String
  type        PromoType // DEPOSIT_BONUS, FREE_BET, ODDS_BOOST, CASHBACK, TOURNAMENT, CUSTOM
  code        String?   @unique // promo code
  conditions  Json     // { minOdds, minStake, eligibleSports, maxUses, etc. }
  reward      Json     // { type, amount, percent, maxReward }
  startDate   DateTime
  endDate     DateTime
  isActive    Boolean  @default(true)
  maxClaims   Int?
  claimCount  Int      @default(0)
  createdBy   String?  // admin
  createdAt   DateTime @default(now())
}

model PromoClaim {
  id          String   @id @default(cuid())
  userId      String
  promotionId String
  promotion   Promotion @relation(fields: [promotionId])
  amount      Decimal?
  claimedAt   DateTime @default(now())
}

model Referral {
  id            String   @id @default(cuid())
  referrerId    String
  referrer      User     @relation("Referrer", fields: [referrerId])
  referredId    String
  referred      User     @relation("Referred", fields: [referredId])
  bonusAmount   Decimal  @default(0)
  referredWagered Decimal @default(0) // how much the referred user wagered
  status        ReferralStatus @default(PENDING) // PENDING, QUALIFIED, REWARDED
  qualifiedAt   DateTime?
  createdAt     DateTime @default(now())
}
```

**Notifications, KYC, API Keys, Audit:**
```prisma
model Notification {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId])
  type        NotifType // BET_SETTLED, DEPOSIT, WITHDRAWAL, PROMOTION, REWARD, VIP_UPGRADE, SYSTEM
  title       String
  message     String
  data        Json?
  isRead      Boolean  @default(false)
  channel     String   @default("IN_APP") // IN_APP, EMAIL, PUSH
  createdAt   DateTime @default(now())
}

model KycDocument {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId])
  type        KycDocType // PASSPORT, DRIVERS_LICENSE, NATIONAL_ID, PROOF_OF_ADDRESS, SELFIE
  fileUrl     String
  status      KycDocStatus @default(PENDING) // PENDING, APPROVED, REJECTED
  reviewedBy  String?
  reviewNote  String?
  reviewedAt  DateTime?
  createdAt   DateTime @default(now())
}

model ApiKey {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId])
  key         String   @unique
  name        String?
  permissions Json     // ["feed", "trading", "account"]
  isActive    Boolean  @default(true)
  lastUsedAt  DateTime?
  rateLimitPerSec Int  @default(1)
  createdAt   DateTime @default(now())
}

model AuditLog {
  id          String   @id @default(cuid())
  userId      String?
  user        User?    @relation(fields: [userId])
  adminId     String?
  action      String   // "login", "bet_placed", "withdrawal", "kyc_approved", etc.
  resource    String?  // "user", "bet", "transaction", etc.
  resourceId  String?
  details     Json?
  ipAddress   String?
  userAgent   String?
  createdAt   DateTime @default(now())
}

model SiteConfig {
  id          String   @id @default(cuid())
  key         String   @unique // "maintenance_mode", "default_language", etc.
  value       Json
  updatedBy   String?
  updatedAt   DateTime @updatedAt
}
```

### Core Infrastructure:
1. Fastify server with plugins (cors, helmet, rate-limit, swagger, websocket)
2. Redis setup for: sessions, odds cache, live data pub/sub, rate limiting
3. BullMQ queues: bet-processing, bet-settlement, reward-calculation, withdrawal-processing, deposit-detection, notification-sender
4. Prisma client with soft-delete middleware
5. Structured logging (pino)
6. Error handling middleware with consistent format
7. Seed data for: all sports, sample competitions/events, VIP tier configs, currencies (40+ cryptos), sample admin wallets

### Deliverables:
- `/prisma/schema.prisma`
- `/prisma/seed.ts` (comprehensive seed)
- `/src/server.ts`
- `/src/config/` (database, redis, queue, constants)
- `/src/middleware/` (auth, rateLimit, errorHandler, logger, adminOnly)
- `/src/queues/` (all queue processors)
- `/src/lib/prisma.ts`, `/src/lib/redis.ts`, `/src/lib/socket.ts`

---

## AGENT 2: AUTH, USER & COMPLETE WALLET/PAYMENT SYSTEM

### Auth System:
- Email/password registration with Zod validation
- OAuth2 (Google, GitHub) with Passport.js
- JWT access (15min) + refresh (7d) token rotation
- TOTP 2FA setup with QR code generation (speakeasy)
- Password reset via email token
- Session tracking in Redis
- Login attempt rate limiting + lockout

### User Profile:
- Full CRUD (username, avatar, preferences, theme, language, odds format)
- Betting history with advanced filters (sport, status, date range, stake range)
- Casino session history
- Activity/audit log view
- Responsible gambling: deposit limits (daily/weekly/monthly), loss limits, session timeout, self-exclusion (1d/7d/30d/permanent)

### KYC System:
- Document upload (S3/local storage)
- 3 verification levels: UNVERIFIED, BASIC (email + DOB), FULL (ID + proof of address)
- Withdrawal limits per level
- Admin review queue with approve/reject + notes
- Auto-expiry reminders

### COMPLETE Crypto Wallet System:
1. **Multi-Currency Wallet Management:**
   - Auto-create wallets per user per enabled currency
   - Balance: available, locked (in bets), bonus (promotional)
   - Fiat-equivalent display using live exchange rates

2. **Deposit System:**
   - Generate unique deposit address per user per currency per network
   - HD wallet derivation (BIP-44): ethers.js for EVM, bitcoinjs-lib for BTC
   - QR code generation for deposit addresses
   - Blockchain monitoring for incoming deposits:
     - EVM chains: ethers.js WebSocket provider watching for transfers
     - BTC: polling electrum/blockstream API
     - Solana: @solana/web3.js subscription
   - Confirmation tracking (configurable per network)
   - Auto-credit to user wallet on required confirmations
   - "Missing deposit?" recovery: manual deposit claim with tx hash
   - No minimum deposit, no fees

3. **Withdrawal System:**
   - Address input + amount + confirmation (2FA if enabled)
   - Minimum withdrawal validation per currency
   - Network fee calculation (live from blockchain or configured)
   - KYC-gated limits:
     - UNVERIFIED: $2,200/day
     - BASIC: $10,000/day
     - FULL: unlimited
   - Auto-approve small withdrawals
   - Admin approval queue for large amounts (configurable threshold)
   - Address whitelist (optional per user)
   - Withdrawal processing queue (BullMQ)
   - Transaction hash tracking + status updates

4. **Fiat On-Ramp Integration:**
   - MoonPay integration:
     - Widget embed (iframe)
     - Webhook callbacks for completed purchases
     - Supported methods: Visa, Mastercard, ApplePay, GooglePay
     - Limits: â‚¬5,000/24h, â‚¬20,000/month
   - Swapped integration:
     - API integration for local payment methods
     - AstroPay, Skrill, Neteller, PIX, UPI, GCash, Paysafecard
     - Minimum: $8
     - Webhook for completed transactions

5. **External Wallet Connectivity:**
   - WalletConnect v2 integration (connect MetaMask, Trust Wallet, Ledger Live)
   - Direct Ledger hardware wallet support via WebUSB/WebHID
   - "Connect Wallet" button â†’ sign message to verify ownership
   - One-click deposit from connected wallet
   - One-click withdrawal to connected wallet
   - Remember connected wallets per user

6. **Admin Wallet Management:**
   - Hot wallet balance monitoring
   - Cold storage integration (display-only for multi-sig)
   - Auto-sweep: when hot wallet > maxThreshold, sweep to cold
   - Auto-refill: when hot wallet < minThreshold, alert admin
   - Per-currency wallet configuration from admin dashboard

7. **Currency Management (Admin Dashboard):**
   - Add/remove cryptocurrencies
   - Enable/disable deposit/withdrawal per currency
   - Configure networks per currency (ERC-20, BEP-20, TRC-20, etc.)
   - Set withdrawal fees and minimums
   - Update exchange rates (manual or API)
   - Set RPC URLs and explorer URLs per network

8. **Internal Currency Swap:**
   - Swap between supported cryptos (e.g., BTC â†’ USDT)
   - Rate from exchange rate API or configured margin
   - Instant swap (internal ledger movement)

### Deliverables:
- `/src/modules/auth/` â€” full auth system
- `/src/modules/users/` â€” profile, preferences, responsible gambling
- `/src/modules/kyc/` â€” upload, review, levels
- `/src/modules/wallets/` â€” COMPLETE wallet system
- `/src/modules/wallets/deposit.service.ts` â€” blockchain monitoring, address generation
- `/src/modules/wallets/withdrawal.service.ts` â€” processing, approval, broadcasting
- `/src/modules/wallets/fiatOnRamp.service.ts` â€” MoonPay + Swapped integration
- `/src/modules/wallets/walletConnect.service.ts` â€” external wallet connectivity
- `/src/modules/wallets/swap.service.ts` â€” internal currency swap
- `/src/modules/wallets/adminWallet.service.ts` â€” hot/cold wallet management
- `/src/modules/wallets/currencyManager.service.ts` â€” admin currency CRUD

---

## AGENT 3: SPORTSBOOK ENGINE (Complete)

### Sports & Events:
- Full CRUD for sports (35+ seeded), competitions, events
- Event lifecycle: UPCOMING â†’ LIVE â†’ ENDED (with CANCELLED, POSTPONED)
- Live score updates via WebSocket broadcast
- Featured events management
- Search across all events

### Odds Engine:
- Market creation with multiple selection types
- Odds calculation: true probability â†’ apply margin â†’ display odds
- Margin management per sport/league (configurable from admin)
- Real-time odds updates pushed via Socket.IO rooms (per event)
- Odds format conversion: decimal â†” fractional â†” american
- Market suspension/reopening (manual + auto on key moments)
- Line movement tracking and history
- Early line support

### Betting System:
- **Single bets**: one selection, validate stake vs limits
- **Parlays/Accumulators**: 2-15 legs, combined odds multiplication
- **Bet Builder** (Same Game Parlay): multiple selections from same event
- **System bets**: combinations (doubles, trebles, etc.)
- Stake validation: min/max per market, per user, per currency
- Odds change handling: "Accept Any", "Accept Better Only", "No Changes"
- Live bet placement with configurable delay (1-10s per sport)
- Danger situation detection â†’ hold bet up to 5 minutes
- Bet cancellation within grace period (configurable, e.g., 3 seconds)
- **Cash-Out System**:
  - Calculate live cash-out value based on current odds
  - Full cash-out: close entire bet
  - Partial cash-out: close X% of bet
  - Auto cash-out: trigger at specified profit/loss threshold
- Bet referenceId for API tracking
- Bet placement via: WEB, MOBILE, API (tracked separately)

### Settlement Engine:
- Auto-settlement triggered on market result entry
- Single bet: straightforward win/loss/void
- Parlay: all legs must win (void leg reduces odds)
- Half-win/half-lose for Asian handicap
- Dead heat rule support
- Settlement queue with retry logic (BullMQ)
- Payout to user wallet on settlement
- Settlement reconciliation report

### Live Betting:
- WebSocket rooms per event (join/leave)
- Real-time score push
- Market auto-suspend on goals/key moments
- Auto-resume after configurable delay
- Live statistics feed (possession, shots, cards â€” simulated)
- Match tracker visualization data
- Bet acceptance delay configurable per sport

### Deliverables:
- `/src/modules/sports/` â€” CRUD, search, lifecycle
- `/src/modules/odds/` â€” odds engine, margins, format conversion
- `/src/modules/betting/` â€” placement, validation, parlays, bet builder
- `/src/modules/betting/cashout.service.ts` â€” cash-out engine
- `/src/modules/settlement/` â€” auto-settlement, payouts, reconciliation
- `/src/modules/live/` â€” WebSocket handlers, live feed, score updates
- `/src/services/oddsEngine.ts` â€” core calculation engine

---

## AGENT 4: CASINO & PROVABLY FAIR GAMES

### Casino Platform:
- Game catalog with categories: Slots, Table Games, Live Casino, Crash, Dice, Mines, Plinko, Virtual Sports
- Game metadata: provider, RTP, volatility, thumbnail, tags, play count
- Advanced search + filter (by provider, type, tags, popularity)
- Recently played + Favorites per user
- Demo mode vs Real Money mode
- Full-screen game player container (iframe for external, native for built-in)

### Built-In Provably Fair Games (fully implemented):

1. **Crash Game (Aviator-style):**
   - Game rounds: countdown â†’ multiplier rising â†’ crash point
   - Provably fair crash point: HMAC-SHA256(serverSeed, `${nonce}`) â†’ deterministic multiplier
   - Place bet before round starts
   - Manual cash-out during flight
   - Auto cash-out at configured multiplier
   - Multi-player: see all active bets, amounts, cash-out points
   - Real-time via WebSocket (shared room)
   - History: last 20 rounds with crash points
   - House edge: configurable (e.g., 3%)

2. **Dice Game:**
   - Roll number 0-99.99
   - Choose over/under + target number
   - Payout calculated: (100 - houseEdge) / winChance
   - Provably fair: HMAC-SHA256(serverSeed, `${clientSeed}:${nonce}`)
   - Auto-bet mode: number of bets, stop on profit/loss
   - Statistics: win/loss streak, total wagered

3. **Coin Flip:**
   - Heads or Tails, 1.98x payout (1% house edge per side)
   - Provably fair
   - Quick play mode

4. **Mines:**
   - Grid of tiles (5x5), choose number of mines (1-24)
   - Reveal tiles to increase multiplier
   - Cash out at any time
   - Hit mine = lose
   - Provably fair mine placement

5. **Plinko:**
   - Drop ball, lands in multiplier slot
   - Configurable rows (8-16), risk level (low/medium/high)
   - Provably fair path determination

### Provably Fair System:
- Server seed: generated per user, SHA-256 hashed and shown BEFORE play
- Client seed: user can set custom seed
- Nonce: auto-incrementing per game
- Verification page: input serverSeed + clientSeed + nonce â†’ shows result
- Seed rotation: user can request new server seed (reveals old one)
- Public verification API endpoint

### Game Provider Integration:
- Generic adapter interface for external providers
- Mock provider with 20 sample games
- Game launch: generate session token â†’ redirect to provider URL
- Callback handling: `/webhooks/provider/:name` for bet/win/refund events
- Balance sync between provider and platform wallet

### Deliverables:
- `/src/modules/casino/` â€” catalog, search, categories, sessions
- `/src/modules/casino/games/crash/` â€” complete crash game
- `/src/modules/casino/games/dice/` â€” dice game
- `/src/modules/casino/games/coinflip/` â€” coin flip
- `/src/modules/casino/games/mines/` â€” mines game
- `/src/modules/casino/games/plinko/` â€” plinko game
- `/src/modules/casino/provablyFair.ts` â€” complete PF system
- `/src/modules/casino/providers/` â€” adapter interface, mock provider, webhooks

---

## AGENT 5: COMPLETE REWARDS, VIP & PROMOTIONS ENGINE

### VIP Tier System:
- 8 tiers: BRONZE â†’ SILVER â†’ GOLD â†’ EMERALD â†’ SAPPHIRE â†’ RUBY â†’ DIAMOND â†’ BLUE_DIAMOND
- Auto-progression based on `totalWagered`
- Configurable thresholds per tier (admin dashboard)
- Tier-up notification + level-up cash reward
- Tier maintenance: minimum monthly wagering to maintain (configurable)
- Tier downgrade protection: 30-day grace period
- VIP dashboard: current tier, progress bar, next tier requirements, benefits comparison

### Rakeback Engine:
- On EVERY bet (sports + casino), calculate: `betAmount * houseEdge * rakebackPercent`
- House edge: configured per game type / market type
- Rakeback split: `walletPercent` goes to wallet immediately, `calendarPercent` goes to Rewards Calendar
- Split ratio depends on VIP tier (higher tier = more to wallet)
- Accumulate rakeback â†’ user clicks "Add" â†’ triggers split + turbo activation
- All rakeback paid as USDT (or configurable currency)

### Rewards Calendar:
- 3 claim slots per day (every 8 hours)
- 12-hour claim window per slot
- Rewards per slot calculated from: base rakeback + lossback + VIP tier bonus
- Visual calendar showing: pending, claimable, claimed, expired
- Daily rewards: small consistent amount
- Weekly rewards: larger amount (Silver+ tier)
- Monthly rewards: largest amount (Gold+ tier)
- Surprise bonus rewards (random multiplier occasionally)

### TURBO Mode:
- Triggered on any calendar claim
- Temporarily boosts CASINO rakeback by `turboBoostPercent` (up to 25%)
- Duration: `turboDurationMin` based on VIP tier (15-90 minutes)
- Countdown timer in UI
- Only one turbo active at a time (claiming again extends)
- Turbo earnings tracked separately for transparency

### Welcome Package:
- Activates on first deposit
- 30-day duration
- 10% rakeback on all bets
- Daily cash drops calculated from play
- Progressive milestone rewards
- Cash Vault: accumulated bonus, claimable on day 30
- Maximum total reward: $2,500
- Auto-transition to regular Cloudbet Rewards after 30 days

### Level-Up Rewards:
- Progressive wagering milestones within each tier
- Cash reward for each milestone crossed
- Milestone spacing increases (1K, 5K, 10K, 50K, 100K, 500K, 1M, etc.)
- Maximum cumulative: $2.5M at highest tiers
- Rewards split like rakeback (wallet + calendar)

### Promotions Engine:
- Admin-created promotions with full configuration:
  - Type: DEPOSIT_BONUS, FREE_BET, ODDS_BOOST, CASHBACK, TOURNAMENT, CUSTOM
  - Conditions: min deposit, min odds, min stake, eligible sports/games, time window
  - Reward: fixed amount, percentage, max cap
  - Max claims (total + per user)
  - Auto-qualification check on eligible activity
- Promo code system: generate, activate, deactivate, usage limits
- Scheduled promotions: auto-start/end
- Promotion analytics: claims, cost, ROI

### Referral Program:
- Unique referral code + shareable link per user
- Track: who referred whom, referee's wagering activity
- Qualification: referee must wager minimum amount
- Tiered rewards: referrer earns % of referee's rakeback (lifetime or limited period)
- Anti-fraud: IP check, same-device detection, minimum play requirement
- Referral dashboard: total referrals, active, qualified, total earned

### Notification Service:
- In-app: bell icon with unread count, notification panel
- Email: configurable templates for each event type (bet settled, deposit confirmed, reward available, VIP upgrade, promotion)
- Push notification stubs (Firebase FCM)
- User preferences: toggle each notification type on/off per channel
- Batch processing via BullMQ notification queue

### Deliverables:
- `/src/modules/vip/` â€” tier management, progression, downgrade
- `/src/modules/rewards/rakeback.service.ts` â€” rakeback calculation on every bet
- `/src/modules/rewards/calendar.service.ts` â€” rewards calendar with 3x daily claims
- `/src/modules/rewards/turbo.service.ts` â€” turbo mode activation and tracking
- `/src/modules/rewards/welcomePackage.service.ts` â€” 30-day package management
- `/src/modules/rewards/levelUp.service.ts` â€” milestone tracking and rewards
- `/src/modules/promotions/` â€” full promo engine, codes, conditions, analytics
- `/src/modules/referrals/` â€” referral tracking, qualification, payouts
- `/src/modules/notifications/` â€” multi-channel notification service
- `/src/services/rewardCalculator.ts` â€” unified reward math engine

---

## AGENT 6: FRONTEND â€” SPORTSBOOK UI

### Global Layout:
- **Top Nav**: Logo, Sports/Casino/Esports/Promos tabs, Search, Wallet balance, Notifications bell, User menu
- **Left Sidebar**: Sports list with icons + live event counts, collapsible, favorites pinned to top
- **Main Content**: Dynamic content area
- **Right Sidebar**: Bet Slip (desktop), Bottom Sheet (mobile)
- **Footer**: Links, support, responsible gambling, social media
- **Theme**: Dark (default), Light, Classic â€” smooth toggle with Framer Motion

### Sports Pages:
- `/sports` â€” Featured events + all sports grid
- `/sports/[sport]` â€” Competitions listing with event counts
- `/sports/[sport]/[competition]` â€” Event listing with quick bet odds buttons
- `/sports/[sport]/[competition]/[event]` â€” Full event page: all markets, stats, match tracker
- `/sports/live` â€” All live events grouped by sport, auto-refreshing scores
- `/sports/search` â€” Full-text search across events

### Bet Slip (CRITICAL COMPONENT):
- Sticky right sidebar (desktop), swipe-up bottom sheet (mobile)
- Tabs: "Bet Slip" + "My Bets (Open)"
- Add selection: click odds button â†’ appears in slip with animation
- Remove: swipe or X button
- Toggle: Single / Parlay / System
- For each selection: event name, market, selection name, odds (live updating with green/red flash)
- Odds change indicators: â†‘ green (better), â†“ red (worse)
- Stake input per bet (singles) or total stake (parlay)
- Quick stake buttons: $10, $25, $50, $100, $500, Custom
- Currency selector dropdown
- Potential win calculation (live updating)
- "Accept odds changes" toggle: Any / Better Only / None
- Place Bet button (with loading state)
- Success: confetti animation + bet reference
- Error: clear message + retry option
- Bet receipt: shareable bet card

### Live Betting:
- Live event cards: team logos, scores, time/period, live indicators (pulsing dot)
- Real-time odds buttons (flash animation on change)
- Match tracker: visual representation of game state (pitch diagram for soccer, court for basketball)
- Statistics panel: possession, shots, corners, cards
- Timeline: key events (goals, cards, substitutions)

### My Bets:
- Open bets: live status, odds, potential win, cash-out button (with value)
- Settled bets: won/lost/void badges, actual win amount, settlement time
- Bet detail modal: all legs with individual status, odds at placement vs current
- Filters: all, open, settled, won, lost
- Pagination

### Deliverables:
- `/frontend/src/app/(sportsbook)/` â€” all pages
- `/frontend/src/components/sportsbook/` â€” EventCard, OddsButton, MarketAccordion, BetSlip, LiveTracker, MatchStats, BetReceipt
- `/frontend/src/hooks/` â€” useOdds(), useBetSlip(), useLive(), useSocket()
- `/frontend/src/stores/betSlipStore.ts` â€” Zustand store for bet slip state
- `/frontend/src/lib/websocket.ts` â€” Socket.IO manager with reconnection
- `/frontend/src/lib/oddsFormat.ts` â€” odds conversion utility

---

## AGENT 7: FRONTEND â€” CASINO, WALLET, ACCOUNT, VIP UI

### Casino Pages:
- `/casino` â€” Lobby: hero banner, category tabs (All, Slots, Live, Table, Crash, Provably Fair), game grid
- `/casino/[category]` â€” Filtered game grid
- `/casino/game/[slug]` â€” Full-screen game player (iframe/native)
- Game cards: thumbnail, name, provider logo, play button, demo badge, favorite heart
- Search + filter by: name, provider, type, tags
- Recently played carousel + Favorites page
- **Crash Game UI** (built-in):
  - Multiplier graph with smooth animation (canvas/d3)
  - Bet panel: stake + place bet before round
  - Auto cash-out input
  - Cash-out button (big, prominent)
  - Active bets panel: other players' bets and cash-outs
  - History: last 20 rounds (color coded: red = low crash, green = high)
- **Dice, Mines, Plinko, Coinflip** â€” Each with custom interactive UI

### Wallet & Payments:
- `/wallet` â€” Overview: all currency balances in grid/list, total portfolio value in USD
- `/wallet/deposit` â€” 
  - Currency selector (40+ with icons)
  - Network selector (ERC-20, BEP-20, TRC-20, etc.)
  - Generated address + QR code
  - "Copy Address" button
  - "Buy with Card" button â†’ MoonPay/Swapped widget
  - "Connect Wallet" button â†’ WalletConnect modal â†’ deposit from MetaMask/Ledger
  - Recent deposits list
  - Missing deposit? â†’ manual claim form
- `/wallet/withdraw` â€”
  - Currency + network selection
  - Withdrawal address input (+ address book / recent addresses)
  - Amount input (+ "Max" button)
  - Fee display (network fee)
  - "You will receive: X" calculation
  - 2FA confirmation if enabled
  - Withdrawal queue status
  - "Withdraw to Connected Wallet" quick button
- `/wallet/transactions` â€”
  - Full transaction history
  - Filter: type (all, deposit, withdrawal, bet, win, bonus, rakeback), currency, date range, status
  - Export CSV
  - Click â†’ transaction detail modal (tx hash link to explorer)
- `/wallet/swap` â€”
  - From/To currency selector
  - Amount input
  - Exchange rate display
  - Swap button
- `/wallet/connect` â€”
  - List of connected external wallets
  - Add new: WalletConnect QR, MetaMask browser extension, Ledger WebUSB
  - Disconnect wallet

### Account Pages:
- `/account/profile` â€” Edit username, avatar, email, password
- `/account/security` â€” 2FA setup (QR code + backup codes), active sessions, password change
- `/account/kyc` â€” Verification status, document upload, progress indicator
- `/account/limits` â€” Deposit/loss/session limits, timeout (1h-30d), self-exclusion
- `/account/preferences` â€” Theme, language, odds format, notifications toggles
- `/account/api` â€” API key generation, active keys, permissions, usage stats

### VIP & Rewards Dashboard:
- `/rewards` â€” Main rewards hub:
  - Current VIP tier badge + name
  - Progress bar to next tier (wagered / required)
  - "Level Up" celebration animation on tier change
- `/rewards/calendar` â€” Visual calendar:
  - Today highlighted
  - 3 daily slots with status: locked/claimable/claimed/expired
  - Claim buttons with coin animation
  - TURBO indicator: active/inactive, countdown timer
  - Weekly + Monthly rewards displayed
- `/rewards/rakeback` â€” Rakeback stats:
  - Total earned (lifetime, this month, this week, today)
  - "Add to Wallet" button (splits to wallet + calendar)
  - Rakeback rate display
  - TURBO mode status + boost percentage
- `/rewards/welcome` â€” Welcome Package tracker:
  - Day counter (Day X of 30)
  - Total earned so far / $2,500 max
  - Daily drops timeline
  - Cash Vault meter (day 30 bonus)
- `/rewards/vip` â€” VIP tiers comparison:
  - All 8 tiers with benefits in a beautiful comparison table
  - Current tier highlighted
  - Benefits: rakeback %, turbo boost, daily/weekly/monthly rewards, level-up max
- `/rewards/referral` â€” Referral dashboard:
  - Personal referral link + share buttons (WhatsApp, Telegram, Twitter, copy)
  - QR code for referral link
  - Stats: total referred, active, qualified, total earned
  - Referral history table

### Deliverables:
- `/frontend/src/app/(casino)/` â€” all casino pages
- `/frontend/src/app/(wallet)/` â€” complete wallet/payment UI
- `/frontend/src/app/(account)/` â€” profile, security, KYC, limits
- `/frontend/src/app/(rewards)/` â€” VIP dashboard, calendar, rakeback, welcome, referral
- `/frontend/src/components/casino/` â€” GameCard, GameGrid, CrashGame, DiceGame, MinesGame, PlinkoGame
- `/frontend/src/components/wallet/` â€” DepositForm, WithdrawForm, BalanceCard, TxHistory, SwapWidget, WalletConnect, QRCode
- `/frontend/src/components/rewards/` â€” TierBadge, ProgressBar, RewardCalendar, TurboTimer, LevelUpAnimation, ReferralCard

---

## AGENT 8: ADMIN DASHBOARD, PUBLIC API, DEVOPS

### Admin Dashboard (route group `/admin`):
- **Dashboard Home**: KPI cards (active users, bets today, revenue today, pending withdrawals, active events, live users), charts (revenue 7d/30d, deposits vs withdrawals, bets by sport)
- **User Management**: searchable table, click â†’ full profile, actions (ban, adjust balance, reset password, change VIP, approve KYC)
- **Payment Management**:
  - Currency Manager: add/remove/enable/disable cryptos, set networks, fees, minimums
  - Fiat On-Ramp: configure MoonPay/Swapped API keys, enable/disable, set limits
  - Withdrawal Approvals: queue of pending large withdrawals, approve/reject with notes
  - Admin Wallets: view hot/cold wallet balances, set thresholds, add/remove wallet addresses
  - Transaction Monitor: real-time feed of all transactions, searchable
- **Sportsbook Management**:
  - Sports/Competitions CRUD
  - Event Manager: create, update scores, live controls (suspend/resume)
  - Market Manager: create markets, set odds, settle results
  - Odds Margin configurator per sport/league
  - Bet Limits configuration
  - Liability Monitor: per event/market exposure
- **Casino Management**:
  - Game catalog: enable/disable, set RTP, configure house edge
  - Provider management: API keys, webhooks
  - Provably fair seed administration
  - Revenue analytics per game
- **Rewards Management**:
  - VIP Tier Configurator: set thresholds, rakeback %, turbo boost, bonuses per tier
  - Rakeback Settings: global percentages, wallet/calendar split ratios
  - TURBO Settings: boost % and duration per tier
  - Welcome Package Config: amounts, duration, Cash Vault
  - Promotion Builder: create/edit/deactivate with full condition builder
  - Promo Code Generator
  - Manual Bonus Granting: give specific user custom reward
  - Referral Settings: commission %, qualification thresholds
- **Reports & Analytics**:
  - Financial: P&L (daily/weekly/monthly), revenue by sport/game, deposit/withdrawal volumes
  - User: new registrations, active users, churn, VIP distribution
  - Betting: volume, popular markets, settlement stats
  - Casino: GGR per game/provider, session analytics
  - Export all reports as CSV/PDF
- **Risk Management**:
  - Large bet alerts (configurable threshold)
  - Win-rate anomaly detection
  - Duplicate account detection (same IP/device)
  - Geo-restriction rules
- **Site Settings**:
  - Maintenance mode toggle
  - Languages configuration
  - Terms/Privacy/Responsible Gambling content editor
  - API rate limit settings
  - Announcement banner

### Public API:
**REST API v1 (`/api/v1/`):**
```
# Feed (public + API key)
GET    /sports
GET    /sports/:sport/competitions
GET    /competitions/:id/events
GET    /events/:id
GET    /events/:id/markets

# Trading (authenticated API key)
POST   /bets/place
GET    /bets/:referenceId/status
GET    /bets/history?limit=&offset=
POST   /bets/:referenceId/cashout

# Account (authenticated API key)
GET    /account/currencies
GET    /account/currencies/:symbol/balance
GET    /account/profile
```

**GraphQL API (`/graphql`):**
```graphql
type Query {
  sports: [Sport!]!
  events(sportKey: String, status: EventStatus, limit: Int): [Event!]!
  event(id: ID!): Event
  odds(eventId: ID!): [Market!]!
  account: Account!
  betHistory(limit: Int, offset: Int): BetConnection!
  balance(currency: String!): Balance!
}

type Mutation {
  placeBet(input: PlaceBetInput!): BetResult!
  cashOut(betId: ID!, amount: Float): CashOutResult!
  cancelBet(betId: ID!): Boolean!
}

type Subscription {
  oddsUpdate(eventId: ID!): MarketUpdate!
  scoreUpdate(eventId: ID!): ScoreUpdate!
  betStatus(referenceId: String!): BetStatusUpdate!
}
```

- API key management (generate/revoke)
- Rate limiting: 1 req/sec on betting, 10 req/sec on feed
- Swagger/OpenAPI auto-generated documentation
- Postman collection export

### DevOps:
```yaml
# docker-compose.yml
services:
  app:        # Node.js backend (Fastify)
  frontend:   # Next.js frontend
  postgres:   # PostgreSQL 16
  redis:      # Redis 7
  nginx:      # Reverse proxy + SSL
  adminer:    # DB admin UI
  bull-board: # Queue monitoring UI
```

- Multi-stage Dockerfiles (build + production)
- Nginx config: reverse proxy, CORS headers, WebSocket upgrade, gzip, rate limiting
- Environment management: `.env.example` with ALL variables documented
- Database backup script (pg_dump, scheduled)
- Health check endpoints: `/health`, `/health/db`, `/health/redis`
- Structured logging with pino (JSON)
- GitHub Actions CI/CD pipeline: lint â†’ test â†’ build â†’ deploy

### Deliverables:
- `/frontend/src/app/admin/` â€” complete admin dashboard (all pages)
- `/src/api/rest/` â€” versioned REST routes
- `/src/api/graphql/` â€” schema, resolvers, subscriptions
- `/src/api/docs/` â€” Swagger spec
- `/docker/` â€” Dockerfile.backend, Dockerfile.frontend, docker-compose.yml, nginx.conf
- `/scripts/` â€” backup.sh, deploy.sh, seed.sh
- `/.github/workflows/ci.yml` â€” CI/CD pipeline
- `/.env.example` â€” documented environment variables

---

## EXECUTION ORDER

```
PHASE 1 (Sequential):
  Agent 1 â†’ Database schema + core infrastructure
  Agent 2 â†’ Auth + User + COMPLETE payment/wallet system

PHASE 2 (Parallel):
  Agent 3 â†’ Sportsbook engine (depends on Agent 1)
  Agent 4 â†’ Casino games (depends on Agent 1)
  Agent 5 â†’ Rewards/VIP engine (depends on Agent 1+2)

PHASE 3 (Parallel):
  Agent 6 â†’ Sportsbook frontend (depends on Agent 3)
  Agent 7 â†’ Casino + Wallet + VIP frontend (depends on Agent 2+4+5)

PHASE 4 (Final):
  Agent 8 â†’ Admin dashboard + API + DevOps (depends on all)
```

## SHARED CONVENTIONS
- TypeScript strict mode everywhere
- Zod for ALL request/response validation
- Money stored as Decimal (Prisma) / string â€” NEVER floating point
- All timestamps in UTC (ISO 8601)
- Consistent error: `{ success: false, error: { code: string, message: string, details?: any } }`
- Consistent success: `{ success: true, data: any, meta?: { page, total, hasMore } }`
- Soft deletes where appropriate (deletedAt timestamp)
- Cursor-based pagination for public APIs, offset for admin
- All secrets encrypted at rest
- Comprehensive input sanitization
- CORS configured for frontend origin only
- Rate limiting on all endpoints

Begin with Agent 1. After completing each agent, provide a summary of files created and proceed to the next.
```

---

## ðŸ“Š COMPLETE FEATURE MATCH: Cloudbet vs Our System

| Feature | Cloudbet | Our System |
|---------|:--------:|:----------:|
| 40+ Cryptocurrencies | âœ… | âœ… (configurable from admin) |
| Multi-chain support (ERC-20, BEP-20, TRC-20, SPL, TON) | âœ… | âœ… |
| No minimum deposit | âœ… | âœ… |
| Fiat On-Ramp (MoonPay, Swapped) | âœ… | âœ… (both integrated) |
| Visa/Mastercard/ApplePay/GooglePay via on-ramp | âœ… | âœ… |
| AstroPay/Skrill/Neteller/PIX/UPI support | âœ… | âœ… |
| External wallet connect (Ledger, MetaMask) | âœ… | âœ… (WalletConnect v2) |
| Hot wallet / Cold storage management | âœ… | âœ… (admin configurable) |
| Add/remove currencies from admin | âœ… | âœ… |
| KYC-gated withdrawal limits | âœ… | âœ… (3 levels) |
| Admin withdrawal approval queue | âœ… | âœ… |
| 35+ Sports betting | âœ… | âœ… |
| Live/In-Play betting | âœ… | âœ… (WebSocket) |
| Bet Builder (Same Game Parlay) | âœ… | âœ… |
| Cash-Out (Full + Partial) | âœ… | âœ… |
| Early lines | âœ… | âœ… |
| Odds boost for crypto bets | âœ… | âœ… |
| 3000+ Casino games (via providers) | âœ… | âœ… (framework + stubs) |
| 300+ Live dealer tables | âœ… | âœ… (provider integration) |
| Crash game (Aviator) | âœ… | âœ… (fully built) |
| Provably fair games (Dice, Mines, Plinko) | âœ… | âœ… (all built) |
| 8-Tier VIP System | âœ… | âœ… (fully configurable) |
| Rakeback on every bet | âœ… | âœ… |
| Rewards Calendar (3x daily claims) | âœ… | âœ… |
| TURBO mode (up to 25% boost, 90 min) | âœ… | âœ… |
| Welcome Package ($2,500 / 30 days) | âœ… | âœ… |
| Cash Vault (Day 30 bonus) | âœ… | âœ… |
| Level-Up Rewards (up to $2.5M) | âœ… | âœ… |
| Referral Program | âœ… | âœ… |
| Promotion engine with promo codes | âœ… | âœ… |
| Drops & Wins tournaments | âœ… | âœ… |
| REST + GraphQL Public API | âœ… | âœ… |
| API key management | âœ… | âœ… |
| Admin Dashboard (full control) | âœ… | âœ… |
| 19 Languages | âœ… | âœ… (i18n ready) |
| Dark/Light/Classic themes | âœ… | âœ… |
| 2FA Security | âœ… | âœ… |
| Responsible gambling tools | âœ… | âœ… |
| Mobile responsive | âœ… | âœ… |
| OAuth (Google, GitHub, Facebook) | âœ… | âœ… |
| Telegram bot/access | âœ… | ðŸ”§ (stub) |
| Buy crypto on-site | âœ… | âœ… |
| Internal currency swap | âœ… | âœ… |
| Missing deposit recovery | âœ… | âœ… |
