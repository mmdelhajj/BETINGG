# CryptoBet â€” Complete Casino Games Implementation

> **This is a Claude Code implementation prompt. Read ENTIRELY before writing any code.**
> **Do NOT ask questions. Implement everything top-to-bottom.**

---

## TABLE OF CONTENTS

1. [Provably Fair System](#1-provably-fair-system)
2. [Game Engine Architecture](#2-game-engine-architecture)
3. [Game 1: Crash (Aviator)](#3-crash-aviator)
4. [Game 2: Dice](#4-dice)
5. [Game 3: Mines](#5-mines)
6. [Game 4: Plinko](#6-plinko)
7. [Game 5: Coinflip](#7-coinflip)
8. [Game 6: Roulette](#8-roulette)
9. [Game 7: Blackjack](#9-blackjack)
10. [Game 8: HiLo](#10-hilo)
11. [Game 9: Wheel of Fortune](#11-wheel-of-fortune)
12. [Game 10: Tower (Stairs)](#12-tower-stairs)
13. [Game 11: Limbo](#13-limbo)
14. [Game 12: Keno](#14-keno)
15. [Game 13: Video Poker](#15-video-poker)
16. [Game 14: Baccarat](#16-baccarat)
17. [Game 15: Slots (Simple)](#17-slots-simple)
18. [Casino Lobby & UI](#18-casino-lobby--ui)
19. [Jackpot System](#19-jackpot-system)
20. [Auto-Bet System](#20-auto-bet-system)
21. [Live Feed & Social](#21-live-feed--social)
22. [Admin Casino Controls](#22-admin-casino-controls)
23. [Database Schema](#23-database-schema)
24. [Implementation Order](#24-implementation-order)

---

## 1. PROVABLY FAIR SYSTEM

### How Provably Fair Works

Every game result is generated using a combination of:
- **Server Seed**: Generated by the server (hidden, revealed after game)
- **Client Seed**: Chosen by the user (or auto-generated)
- **Nonce**: Incrementing counter per user (prevents replay)

The result = HMAC-SHA256(serverSeed, clientSeed:nonce)

This allows users to VERIFY that the game was fair AFTER playing.

### File: `src/services/casino/ProvablyFairService.ts`

```typescript
import crypto from 'crypto';

export class ProvablyFairService {
  
  // GENERATE SERVER SEED
  // Called once when user starts a new seed pair
  generateServerSeed(): { seed: string; hash: string } {
    const seed = crypto.randomBytes(32).toString('hex');
    const hash = crypto.createHash('sha256').update(seed).digest('hex');
    return { seed, hash }; // Show hash to user, keep seed hidden
  }
  
  // GENERATE GAME RESULT
  // Universal function for all games
  generateResult(serverSeed: string, clientSeed: string, nonce: number): number {
    const hmac = crypto.createHmac('sha256', serverSeed)
      .update(`${clientSeed}:${nonce}`)
      .digest('hex');
    
    // Take first 8 hex chars â†’ convert to number between 0 and 1
    const int = parseInt(hmac.substring(0, 8), 16);
    return int / 0x100000000; // Returns 0.0 to 0.999999...
  }
  
  // GENERATE MULTIPLE RESULTS (for games needing multiple random numbers)
  // e.g., Mines needs 25 positions, Plinko needs path decisions, etc.
  generateMultipleResults(
    serverSeed: string, 
    clientSeed: string, 
    nonce: number, 
    count: number
  ): number[] {
    const results: number[] = [];
    for (let i = 0; i < count; i++) {
      const hmac = crypto.createHmac('sha256', serverSeed)
        .update(`${clientSeed}:${nonce}:${i}`)
        .digest('hex');
      const int = parseInt(hmac.substring(0, 8), 16);
      results.push(int / 0x100000000);
    }
    return results;
  }
  
  // CRASH GAME specific: Convert hash to crash point
  generateCrashPoint(serverSeed: string, clientSeed: string, nonce: number): number {
    // Using Stake.com's crash algorithm
    const hmac = crypto.createHmac('sha256', serverSeed)
      .update(`${clientSeed}:${nonce}`)
      .digest('hex');
    
    const h = parseInt(hmac.substring(0, 8), 16);
    const e = Math.pow(2, 32); // 2^32
    const houseEdge = 0.03; // 3% house edge
    
    // Formula: max(1, (1 - houseEdge) * e / (e - h))
    const result = (1 - houseEdge) * e / (e - h);
    return Math.max(1.00, Math.floor(result * 100) / 100);
  }
  
  // VERIFICATION ENDPOINT
  // User provides: serverSeed, clientSeed, nonce â†’ we return the result
  // They can verify independently using the same algorithm
  verify(serverSeed: string, clientSeed: string, nonce: number, gameType: string): any {
    switch (gameType) {
      case 'crash': return this.generateCrashPoint(serverSeed, clientSeed, nonce);
      case 'dice': return this.generateResult(serverSeed, clientSeed, nonce) * 100; // 0-99.99
      case 'coinflip': return this.generateResult(serverSeed, clientSeed, nonce) < 0.5 ? 'heads' : 'tails';
      // ... etc for each game
    }
  }
}
```

### API Endpoints for Provably Fair

```
GET  /api/v1/casino/fairness/seed         â€” Get current seed pair (hash only)
POST /api/v1/casino/fairness/rotate        â€” Rotate seeds (reveals old server seed, generates new)
POST /api/v1/casino/fairness/client-seed   â€” Set custom client seed
POST /api/v1/casino/fairness/verify        â€” Verify a past game result
GET  /api/v1/casino/fairness/history       â€” Past seed pairs and game results
```

### Frontend: Provably Fair Modal

```
â”Œâ”€ Provably Fair â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                 â”‚
â”‚  Current Seeds                                  â”‚
â”‚  Server Seed (hashed): a3f2b7c9...             â”‚
â”‚  Client Seed: [___adjustable___] [Change]       â”‚
â”‚  Nonce: 47                                      â”‚
â”‚                                                 â”‚
â”‚  [Rotate Seeds]                                 â”‚
â”‚  (This will reveal the current server seed      â”‚
â”‚   and generate a new seed pair)                 â”‚
â”‚                                                 â”‚
â”‚  â”€â”€ Verify Past Game â”€â”€                         â”‚
â”‚  Game ID: [________________]                    â”‚
â”‚  Server Seed: [________________]                â”‚
â”‚  Client Seed: [________________]                â”‚
â”‚  Nonce: [____]                                  â”‚
â”‚  [Verify] â†’ Result: 2.47x âœ…                    â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. GAME ENGINE ARCHITECTURE

### File: `src/services/casino/BaseGame.ts`

```typescript
export abstract class BaseGame {
  abstract name: string;
  abstract slug: string;
  abstract houseEdge: number; // Configurable from admin
  abstract minBet: number;
  abstract maxBet: number;
  
  // Every game follows this flow:
  // 1. validateBet() â€” check stake, balance, game-specific rules
  // 2. deductBalance() â€” atomic: take money from wallet
  // 3. generateResult() â€” provably fair random generation
  // 4. calculatePayout() â€” game-specific win/loss logic
  // 5. creditWinnings() â€” if won, add to wallet
  // 6. recordRound() â€” save to database for audit
  // 7. broadcastResult() â€” Socket.IO to live feed
  
  abstract play(userId: string, betRequest: any): Promise<GameResult>;
}

interface GameResult {
  roundId: string;
  game: string;
  betAmount: number;
  payout: number;
  profit: number; // payout - betAmount
  multiplier: number;
  result: any; // game-specific result data
  fairness: {
    serverSeedHash: string;
    clientSeed: string;
    nonce: number;
  };
}
```

### Socket.IO Events for Casino

```
// Emitted for live feed (all users can see):
"casino:bet" â†’ { userId, nickname, avatar, game, betAmount, payout, multiplier, timestamp }

// Emitted to specific game rooms:
"crash:tick" â†’ { multiplier, elapsed }  (every 100ms during crash game)
"crash:bust" â†’ { bustPoint }
"crash:start" â†’ { countdown }

// Emitted to specific user:
"casino:result" â†’ { roundId, payout, balance }
```

---

## 3. CRASH (AVIATOR)

### The Most Popular Crypto Casino Game

**How it works:**
- A multiplier starts at 1.00x and rises continuously
- Players bet before the round starts
- The multiplier can CRASH at any point (1.00x to âˆ, but usually 1-100x)
- Players must CASH OUT before the crash to win
- If they don't cash out in time â†’ lose their bet
- Payout = bet Ã— multiplier at cash out time

### Backend: `src/services/casino/games/CrashGame.ts`

```typescript
export class CrashGame {
  // STATE: WAITING â†’ COUNTDOWN â†’ RUNNING â†’ CRASHED
  
  // Game loop runs on server:
  // 1. WAITING (5-10 seconds): Accept bets
  // 2. COUNTDOWN (3 seconds): "3... 2... 1... GO!"
  // 3. RUNNING: Multiplier ticks up every 100ms
  //    - Emit "crash:tick" with current multiplier
  //    - Players can cash out at any time
  //    - When multiplier reaches bustPoint â†’ CRASHED
  // 4. CRASHED: Round over
  //    - Players who cashed out: win bet Ã— their cashout multiplier
  //    - Players who didn't: lose entire bet
  //    - Wait 5 seconds â†’ back to WAITING
  
  // BUST POINT CALCULATION:
  // Generated BEFORE round starts using provably fair algorithm
  // bustPoint = generateCrashPoint(serverSeed, clientSeed, nonce)
  // House edge: 3% (configurable)
  // This means 3% of rounds crash at exactly 1.00x (instant loss)
  
  // MULTIPLIER CURVE:
  // multiplier(t) = Math.pow(Math.E, 0.00006 * t)
  // where t = milliseconds since start
  // This creates a smooth exponential curve
  
  // TWO BET SLOTS (like Aviator):
  // Players can place TWO independent bets per round
  // Each bet can have its own auto-cashout multiplier
  
  // AUTO CASHOUT:
  // Player sets a target multiplier (e.g., 2.00x)
  // Server automatically cashes out when reached
  // Must check BEFORE each tick if auto-cashout triggered
  
  // ACTIVE BETS DISPLAY:
  // Show all current bets: player, amount, status (playing/cashed out/busted)
  // When someone cashes out: flash green in the list
  
  // HISTORY:
  // Show last 20-50 bust points as colored bubbles:
  //   < 2x = red
  //   2x-10x = orange  
  //   10x+ = green/gold
}
```

### Frontend: Canvas Animation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚                         12.47x                          â”‚  â† HUGE number (48px font)
â”‚                                                         â”‚
â”‚         â•±                                               â”‚
â”‚        â•±  â† Exponential curve (Canvas 2D)              â”‚
â”‚       â•±                                                 â”‚
â”‚      â•±                                                  â”‚
â”‚     â•±                                                   â”‚
â”‚    â•±                                                    â”‚
â”‚   â•±                                                     â”‚
â”‚  â•±                                                      â”‚
â”‚ â•±___________________________________________________    â”‚
â”‚                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   BET 1            â”‚    BET 2                           â”‚
â”‚   $[10.00] [Â½][2x] â”‚    $[5.00] [Â½][2x]                â”‚
â”‚   Auto: [2.00x]    â”‚    Auto: [___]                     â”‚
â”‚   [CASH OUT 19.47] â”‚    [PLACE BET]                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ACTIVE BETS (47 players)                              â”‚
â”‚   ğŸŸ¢ Player1  $50.00  â†’ $124.75 (2.49x) CASHED OUT    â”‚
â”‚   ğŸ”´ Player2  $10.00  â†’ Playing...                      â”‚
â”‚   ğŸŸ¢ Player3  $100.00 â†’ $200.00 (2.00x) CASHED OUT    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   HISTORY: [1.24x] [3.47x] [1.00x] [89.2x] [2.11x]   â”‚
â”‚             ğŸ”´      ğŸŸ        ğŸ”´      ğŸŸ¢       ğŸŸ        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. DICE

**How it works:**
- Player chooses OVER or UNDER a target number
- Roll range: 0.00 to 99.99
- Player sets target (e.g., "Roll Under 50.00")
- Win chance = target / 100 (for under) or (100 - target) / 100 (for over)
- Multiplier = (100 - houseEdge) / winChance

### Backend Logic

```typescript
// Roll = generateResult() * 100 â†’ 0.00 to 99.99

// WIN CONDITION:
// Under: roll < target â†’ WIN
// Over: roll > target â†’ WIN

// MULTIPLIER CALCULATION:
// multiplier = (100 - houseEdge%) / winChance%
// Example: Under 50 â†’ winChance=50% â†’ multiplier = 97/50 = 1.94x (with 3% edge)
// Example: Under 10 â†’ winChance=10% â†’ multiplier = 97/10 = 9.70x

// SLIDER: User can adjust target from 1.00 to 98.00
// As they slide: win chance and multiplier update in real-time
```

### Frontend

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                  â”‚
â”‚              ROLL RESULT: 34.72                  â”‚  â† Big animated number
â”‚                                                  â”‚
â”‚  0 â•â•â•â•â•â•â•â•â•â•â•â•â—â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• 100   â”‚  â† Slider
â”‚               â†‘ 50.00                            â”‚
â”‚           [UNDER]  [OVER]                        â”‚
â”‚                                                  â”‚
â”‚  Win Chance: 50.00%    Multiplier: 1.9400x       â”‚
â”‚  Profit on Win: $9.40                            â”‚
â”‚                                                  â”‚
â”‚  Bet: $[5.00]  [Â½] [2x] [Max]                   â”‚
â”‚  [ROLL DICE]                                     â”‚
â”‚                                                  â”‚
â”‚  History: 72.41 âŒ | 23.15 âœ… | 88.90 âŒ        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. MINES

**How it works:**
- 5Ã—5 grid (25 tiles)
- Hidden under tiles: gems (safe) and mines (bombs)
- Player chooses how many mines (1-24)
- More mines = higher multiplier per revealed gem
- Click tiles to reveal gems, cash out any time
- Hit a mine = lose everything

### Backend Logic

```typescript
// Mine positions generated using provably fair:
// generateMultipleResults(serverSeed, clientSeed, nonce, 25)
// Sort by result value, first N indices = mine positions
// Example: 5 mines â†’ the 5 positions with lowest random values are mines

// MULTIPLIER per safe tile revealed:
// After revealing k tiles with m mines on a 25-tile grid:
// multiplier(k) = (25! / (25-k)!) / ((25-m)! / (25-m-k)!) Ã— (1 - houseEdge)
// Simplified: each reveal multiplies by (25-k) / (25-m-k) approximately

// PROGRESSIVE MULTIPLIER TABLE (5 mines, 3% edge):
// 1 gem: 1.18x
// 2 gems: 1.41x
// 3 gems: 1.70x
// 5 gems: 2.55x
// 10 gems: 9.51x
// 15 gems: 63.37x
// 20 gems: 3538.5x (maximum possible)

// CASH OUT: Player can cash out after any successful reveal
// payout = bet Ã— current_multiplier
```

### Frontend

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MINES   Bombs: [5 â–¼]                 â”‚
â”‚                                          â”‚
â”‚   â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”                â”‚
â”‚   â”‚ ğŸ’â”‚ ? â”‚ ? â”‚ ? â”‚ ? â”‚                â”‚
â”‚   â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤                â”‚
â”‚   â”‚ ? â”‚ ğŸ’â”‚ ? â”‚ ? â”‚ ? â”‚                â”‚
â”‚   â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤                â”‚
â”‚   â”‚ ? â”‚ ? â”‚ ? â”‚ ? â”‚ ? â”‚                â”‚
â”‚   â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤                â”‚
â”‚   â”‚ ? â”‚ ? â”‚ ? â”‚ ? â”‚ ? â”‚                â”‚
â”‚   â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤                â”‚
â”‚   â”‚ ? â”‚ ? â”‚ ? â”‚ ? â”‚ ? â”‚                â”‚
â”‚   â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜                â”‚
â”‚                                          â”‚
â”‚   Gems Found: 2    Next: 1.70x          â”‚
â”‚   Current Profit: +$4.10                 â”‚
â”‚                                          â”‚
â”‚   Bet: $[5.00]   [CASH OUT $7.05]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. PLINKO

**How it works:**
- Ball drops from top through a triangular grid of pegs
- Ball bounces left or right at each peg (provably fair per bounce)
- Lands in a bucket at the bottom with a multiplier
- Higher risk = more extreme multipliers (both high and low)

### Backend Logic

```typescript
// ROWS: 8, 12, or 16 (user selects)
// RISK: Low, Medium, High (affects multiplier distribution)
// At each peg: ball goes left (0) or right (1)
// generateMultipleResults() â†’ one per row â†’ if < 0.5 go left, else right
// Final position determines the multiplier bucket

// MULTIPLIER TABLES (example for 16 rows, Medium risk):
// Bucket positions (center = most likely):
// [110x, 41x, 10x, 5x, 3x, 1.5x, 1x, 0.5x, 0.3x, 0.5x, 1x, 1.5x, 3x, 5x, 10x, 41x, 110x]

// RISK LEVELS affect bucket multipliers:
// Low:    [5.6x ... 0.5x ... 5.6x]      (safe, small range)
// Medium: [110x ... 0.3x ... 110x]       (moderate)
// High:   [1000x ... 0x ... 1000x]       (extreme)
```

### Frontend (Physics Animation)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Risk: [Low] [Medium] [High]            â”‚
â”‚  Rows: [8] [12] [16]                    â”‚
â”‚                                          â”‚
â”‚              â—                           â”‚  â† Ball drops
â”‚             â—‹ â—‹                          â”‚
â”‚            â—‹ â—‹ â—‹                         â”‚
â”‚           â—‹ â—‹ â—‹ â—‹                        â”‚  â† Pegs (triangular grid)
â”‚          â—‹ â—‹ â—‹ â—‹ â—‹                       â”‚
â”‚         â—‹ â—‹ â—‹ â—‹ â—‹ â—‹                      â”‚
â”‚        â—‹ â—‹ â—‹ â—‹ â—‹ â—‹ â—‹                     â”‚
â”‚       â—‹ â—‹ â—‹ â—‹ â—‹ â—‹ â—‹ â—‹                    â”‚
â”‚      â—‹ â—‹ â—‹ â—‹ â—‹ â—‹ â—‹ â—‹ â—‹                   â”‚
â”‚  â”Œâ”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”          â”‚
â”‚  â”‚110â”‚41â”‚10â”‚5xâ”‚1xâ”‚.3â”‚1xâ”‚5xâ”‚110â”‚         â”‚  â† Multiplier buckets
â”‚  â””â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”˜          â”‚
â”‚   ğŸŸ¥ ğŸŸ§ ğŸŸ¨ ğŸŸ© ğŸŸ© ğŸŸ© ğŸŸ¨ ğŸŸ§ ğŸŸ¥          â”‚  â† Color gradient
â”‚                                          â”‚
â”‚  Bet: $[5.00]  [DROP BALL]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- Use Canvas 2D or matter.js for physics
- Ball should realistically bounce between pegs
- Ball leaves trail/glow as it falls
- Bucket lights up when ball lands

---

## 7. COINFLIP

Simple 50/50 game.

```typescript
// result = generateResult() < 0.5 ? 'heads' : 'tails'
// BUT with house edge: actual threshold is 0.485 for chosen side (3% edge)
// Or: pay 1.94x instead of 2.00x
// Multiplier: 2 Ã— (1 - houseEdge) = 1.94x (with 3% edge)
```

### Frontend: 3D Coin Animation
- CSS 3D transform for coin flip
- Gold coin with heads/tails graphics
- Spinning animation (1-2 seconds)
- Landing with bounce effect

---

## 8. ROULETTE

### European Roulette (37 numbers: 0-36)

```typescript
// result = Math.floor(generateResult() * 37) â†’ 0 to 36
// Bet types and payouts:
// Straight (single number): 35:1
// Split (2 numbers): 17:1
// Street (3 numbers): 11:1
// Corner (4 numbers): 8:1
// Line (6 numbers): 5:1
// Dozen (12 numbers): 2:1
// Column (12 numbers): 2:1
// Red/Black: 1:1
// Odd/Even: 1:1
// High/Low: 1:1
// 0 is green â†’ red/black/odd/even bets lose

// House edge: 2.7% (built into the 0)
```

### Frontend
- Animated roulette wheel (CSS or Canvas)
- Betting board with click-to-place chips
- Ball spinning animation
- Multiple chip denominations ($1, $5, $25, $100)

---

## 9. BLACKJACK

### Standard Blackjack Rules

```typescript
// Card deck generated using provably fair seeds
// shuffledDeck = generateMultipleResults(seed, clientSeed, nonce, 52)
// Map to cards: index % 13 = rank, index / 13 = suit

// Rules:
// - Player gets 2 cards, dealer gets 2 (one face down)
// - Aces = 1 or 11, Face cards = 10
// - Goal: get closer to 21 than dealer without going over
// - Hit: take another card
// - Stand: keep current hand
// - Double Down: double bet, get exactly one more card
// - Split: if pair, split into two hands (separate bets)
// - Insurance: if dealer shows Ace, bet half on dealer blackjack (pays 2:1)
// - Blackjack (Ace + 10-value) = pays 3:2 (1.5x bet)
// - Dealer must hit on 16 or less, stand on 17+
// - Bust (over 21) = automatic loss

// House edge: ~0.5% with basic strategy (built into rules)

// Payouts:
// Win: 1:1 (bet + bet)
// Blackjack: 3:2 (bet + 1.5Ã—bet)
// Insurance: 2:1
// Push (tie): bet returned
```

### Frontend
- Card dealing animation (slide from deck)
- Card flip animation for dealer reveal
- Hit/Stand/Double/Split buttons
- Chip stack display
- Running card total display

---

## 10. HILO

**How it works:**
- A card is revealed
- Player guesses if next card is Higher or Lower
- Correct guess = multiplier increases
- Can cash out any time
- Wrong guess = lose all

```typescript
// Deck: standard 52 cards
// After each guess: multiplier increases based on probability
// If 7 cards are higher and 5 are lower:
//   Guess higher: multiplier increases by 52 / (52 - 7) = less increase (easier)
//   Guess lower: multiplier increases by 52 / (52 - 5) = more increase (harder)
// SKIP option: pay small fee to skip a card
// Ace is always highest (or lowest based on rule setting)
```

---

## 11. WHEEL OF FORTUNE

```typescript
// Wheel with colored segments
// Each segment has a multiplier
// Segments and probabilities (example):
// Gray (1.2x): 40% chance â†’ 24 segments
// Blue (1.5x): 30% chance â†’ 18 segments
// Purple (2x): 15% chance â†’ 9 segments
// Red (5x): 10% chance â†’ 6 segments
// Gold (50x): 5% chance â†’ 3 segments

// Total segments: 60
// result = Math.floor(generateResult() * 60)
// Map to segment â†’ get multiplier

// House edge built into multipliers:
// Expected value = sum(probability Ã— multiplier) < 1.0
```

### Frontend
- CSS animated spinning wheel
- Easing function for slowdown
- Pointer at top
- Confetti on big wins

---

## 12. TOWER (STAIRS)

**How it works:**
- Grid with rows (levels) going up
- Each row has 3-4 tiles, only 1-2 are safe
- Pick a tile per row, climb up
- Hit a trap = lose all
- Cash out any time
- Higher rows = higher multiplier

```typescript
// Difficulty modes:
// Easy: 4 tiles per row, 3 safe, 1 trap
// Medium: 3 tiles per row, 2 safe, 1 trap
// Hard: 3 tiles per row, 1 safe, 2 traps
// Expert: 4 tiles per row, 1 safe, 3 traps

// 10 rows per game
// Multiplier increases per row cleared
// Easy row 1: 1.31x â†’ row 10: 14.95x
// Hard row 1: 2.91x â†’ row 10: 11,780x
```

---

## 13. LIMBO

**How it works:**
- Player sets a target multiplier (e.g., 2.00x)
- Game generates a random multiplier
- If generated multiplier >= target â†’ WIN (pays targetÃ—bet)
- If generated multiplier < target â†’ LOSE

```typescript
// result = generateCrashPoint() using same algorithm as crash
// Win if result >= targetMultiplier
// Payout = bet Ã— targetMultiplier
// Higher target = less chance to win but bigger payout

// Win probability = (1 - houseEdge) / targetMultiplier
// Example: target 2x â†’ ~48.5% chance (with 3% edge)
// Example: target 10x â†’ ~9.7% chance
// Example: target 100x â†’ ~0.97% chance
```

### Frontend
- Single big number display
- Animates counting up from 1.00x
- Stops at generated result
- Green if >= target, red if < target

---

## 14. KENO

```typescript
// Grid of 40 numbers (1-40)
// Player picks 1-10 numbers
// System draws 10 random numbers
// Payout based on how many matches

// Draw: generateMultipleResults(seed, client, nonce, 10)
// Map each to 1-40, no duplicates

// Payout table (example, 10 picks):
// 0 matches: 0x
// 1 match: 0x
// 2 matches: 0x
// 3 matches: 0.5x
// 4 matches: 2x
// 5 matches: 5x
// 6 matches: 25x
// 7 matches: 100x
// 8 matches: 500x
// 9 matches: 5000x
// 10 matches: 50000x
```

---

## 15. VIDEO POKER

```typescript
// Jacks or Better rules
// Deal 5 cards, player holds/discards
// Redraw discarded cards
// Payout based on final hand:
// Royal Flush: 800x
// Straight Flush: 50x
// Four of a Kind: 25x
// Full House: 9x
// Flush: 6x
// Straight: 4x
// Three of a Kind: 3x
// Two Pair: 2x
// Jacks or Better: 1x
// Nothing: 0x
```

---

## 16. BACCARAT

```typescript
// Player vs Banker
// Bet on: Player, Banker, or Tie
// Standard baccarat rules (card drawing rules)
// Payouts:
//   Player win: 1:1
//   Banker win: 0.95:1 (5% commission)
//   Tie: 8:1
// House edge: ~1.06% (Banker), ~1.24% (Player), ~14.36% (Tie)
```

---

## 17. SLOTS (SIMPLE)

```typescript
// 3Ã—3 or 5Ã—3 grid
// Symbols: ğŸ’ ğŸ‹ ğŸŠ ğŸ‡ ğŸ”” ğŸ’ 7ï¸âƒ£ â­
// Each reel independently determined by provably fair
// Paylines: center row, top row, bottom row, diagonals (5-20 paylines)
// Match 3+ symbols on payline = win

// Symbol weights (determines RTP):
// ğŸ’ = 30% (common, low payout 2x)
// ğŸ‹ = 25% 
// ğŸŠ = 20%
// ğŸ‡ = 12%
// ğŸ”” = 8%
// ğŸ’ = 3% (rare, high payout 50x)
// 7ï¸âƒ£ = 1.5%
// â­ = 0.5% (jackpot, 500x)

// RTP (Return to Player) target: 96-97%
// Adjust symbol weights to achieve target RTP
```

### Frontend
- Spinning reel animation
- One reel stops at a time (left to right)
- Winning paylines flash/highlight
- Big win animation for large multipliers

---

## 18. CASINO LOBBY & UI

### Casino Lobby Page: `/casino`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CASINO                                                      â”‚
â”‚                                                              â”‚
â”‚  [Originals] [Slots] [Live Casino] [Table Games] [All]      â”‚
â”‚                                                              â”‚
â”‚  ğŸ”¥ Popular Games                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚Crash â”‚ â”‚Mines â”‚ â”‚Dice  â”‚ â”‚Plinkoâ”‚ â”‚Black-â”‚ â”‚Roul- â”‚    â”‚
â”‚  â”‚ğŸš€    â”‚ â”‚ğŸ’£    â”‚ â”‚ğŸ²    â”‚ â”‚âš¡    â”‚ â”‚jack  â”‚ â”‚ette  â”‚    â”‚
â”‚  â”‚      â”‚ â”‚      â”‚ â”‚      â”‚ â”‚      â”‚ â”‚ğŸƒ    â”‚ â”‚ğŸ°    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                              â”‚
â”‚  ğŸ® All Original Games                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚Coin- â”‚ â”‚HiLo  â”‚ â”‚Wheel â”‚ â”‚Tower â”‚ â”‚Limbo â”‚ â”‚Keno  â”‚    â”‚
â”‚  â”‚flip  â”‚ â”‚ğŸ“Š    â”‚ â”‚ğŸ¡    â”‚ â”‚ğŸ—ï¸   â”‚ â”‚â¬†ï¸    â”‚ â”‚ğŸ±    â”‚    â”‚
â”‚  â”‚ğŸª™    â”‚ â”‚      â”‚ â”‚      â”‚ â”‚      â”‚ â”‚      â”‚ â”‚      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚  â”‚Video â”‚ â”‚Bacca-â”‚ â”‚Slots â”‚                                â”‚
â”‚  â”‚Poker â”‚ â”‚rat   â”‚ â”‚ğŸ°   â”‚                                â”‚
â”‚  â”‚ğŸƒ    â”‚ â”‚ğŸ´    â”‚ â”‚      â”‚                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                                              â”‚
â”‚  â”€â”€ LIVE BETS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€             â”‚
â”‚  ğŸŸ¢ user123 won $47.50 on Crash (2.38x)   just now        â”‚
â”‚  ğŸ”´ player99 lost $10.00 on Dice           2s ago          â”‚
â”‚  ğŸŸ¢ whale_btc won $1,240.00 on Mines (12.4x) 5s ago       â”‚
â”‚  ğŸŸ¢ lucky7 won $89.00 on Plinko (17.8x)   8s ago          â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Game Cards Design
- Thumbnail/icon per game
- Game name
- "PROVABLY FAIR" badge
- Hover: slight scale up + glow
- Number of active players (optional)

### Game Page Layout (Universal Template)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† Back to Casino    CRASH    [Provably Fair ğŸ”’]         â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                     â”‚ â”‚
â”‚  â”‚              GAME AREA                              â”‚ â”‚
â”‚  â”‚         (specific to each game)                     â”‚ â”‚
â”‚  â”‚                                                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚    BET CONTROLS      â”‚    GAME HISTORY              â”‚ â”‚
â”‚  â”‚    Amount: [$10.00]  â”‚    #1234 â†’ 2.47x âœ… +$14.70 â”‚ â”‚
â”‚  â”‚    [Â½] [2x] [Max]   â”‚    #1233 â†’ 1.00x âŒ -$10.00 â”‚ â”‚
â”‚  â”‚                      â”‚    #1232 â†’ 5.12x âœ… +$41.20 â”‚ â”‚
â”‚  â”‚    [PLAY / BET]      â”‚    ...                       â”‚ â”‚
â”‚  â”‚                      â”‚    [View All History]        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 19. JACKPOT SYSTEM

```typescript
// Progressive jackpot: Small % of every bet feeds the jackpot pool
// jackpotContribution = betAmount Ã— 0.01 (1%)
// Random chance to trigger jackpot on any bet
// Jackpot trigger probability based on bet size (bigger bet = higher chance)

// THREE JACKPOT TIERS:
// Mini: Seeds at $100, can grow to ~$500 (triggers ~every 1 hour)
// Major: Seeds at $1,000, can grow to ~$10,000 (triggers ~every day)
// Grand: Seeds at $10,000, can grow to ~$100,000 (triggers ~every week)

// Display on casino lobby: Live jackpot amounts ticking up
```

---

## 20. AUTO-BET SYSTEM

Every game should support auto-bet:

```typescript
// Auto-bet settings (shared across all games):
interface AutoBetConfig {
  enabled: boolean;
  numberOfBets: number;         // 0 = infinite
  betAmount: number;
  
  // On Win:
  onWin: 'reset' | 'increase';
  onWinIncreasePercent: number;  // e.g., 50% â†’ next bet = current Ã— 1.5
  
  // On Loss:
  onLoss: 'reset' | 'increase';
  onLossIncreasePercent: number; // e.g., 100% â†’ Martingale doubling
  
  // Stop conditions:
  stopOnProfit: number;         // Stop if total profit >= this
  stopOnLoss: number;           // Stop if total loss >= this
  stopOnWin: boolean;           // Stop on first win
  
  // Game-specific:
  autoCashout?: number;         // For Crash: auto cashout multiplier
  target?: number;              // For Dice: target number
  mineCount?: number;           // For Mines: number of mines
}

// Auto-bet runs SERVER-SIDE to prevent manipulation
// Delay between auto-bets: 1-2 seconds (configurable)
// Stop immediately if balance insufficient
```

---

## 21. LIVE FEED & SOCIAL

### Live Bets Feed (Global)
- Shows across entire site (sidebar or bottom ticker)
- Real-time via Socket.IO
- Format: "[avatar] [name] won/lost [$amount] on [game] [(multiplier)]"
- Color: green for wins, red for losses
- Big wins (>$100) get special animation/highlight
- Clickable: view the game round

### Chat (Optional)
- Per-game chat room
- Emoji support
- Rain feature: user can "rain" tips to chat
- Mute/report users

---

## 22. ADMIN CASINO CONTROLS

### Additional Admin Endpoints for Casino

```
GET    /api/v1/admin/casino/overview
  // Returns: totalGames, totalRounds, GGR, activeJackpots, topGames

GET    /api/v1/admin/casino/games
  // List all games with: enabled, rounds, revenue, houseEdge, RTP

PUT    /api/v1/admin/casino/games/:slug
  // Body: { enabled, houseEdge, minBet, maxBet, maxPayout }
  // Adjust per-game settings

GET    /api/v1/admin/casino/games/:slug/rounds
  // Query: ?userId=&minBet=&dateFrom=&dateTo=&page=
  // Audit trail: every round with result, bet, payout, fairness data

GET    /api/v1/admin/casino/games/:slug/stats
  // Returns: { totalRounds, totalWagered, totalPayout, actualRTP, houseProfit }
  // actualRTP = totalPayout / totalWagered Ã— 100 (should be close to theoretical)

PUT    /api/v1/admin/casino/jackpot
  // Body: { mini: { seed, current }, major: {...}, grand: {...} }
  // Manually set jackpot values

GET    /api/v1/admin/casino/suspicious
  // Flag rounds with unusual patterns:
  // - User winning too frequently
  // - Unusual bet patterns (Martingale abuse)
  // - Same seed pair used excessively
```

---

## 23. DATABASE SCHEMA

```sql
-- Casino Game Rounds (audit trail for ALL games)
CREATE TABLE casino_rounds (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) NOT NULL,
  game VARCHAR(50) NOT NULL, -- 'crash', 'dice', 'mines', etc.
  bet_amount DECIMAL(18,8) NOT NULL,
  currency VARCHAR(10) DEFAULT 'USD',
  payout DECIMAL(18,8) DEFAULT 0,
  profit DECIMAL(18,8) DEFAULT 0, -- payout - bet_amount
  multiplier DECIMAL(12,4) DEFAULT 0,
  result JSONB NOT NULL, -- game-specific result data
  
  -- Provably fair data
  server_seed_hash VARCHAR(64) NOT NULL,
  client_seed VARCHAR(64) NOT NULL,
  nonce INTEGER NOT NULL,
  server_seed VARCHAR(64), -- NULL until seed rotated, then revealed
  
  -- Game-specific
  game_data JSONB, -- stores game state (e.g., mine positions, cards dealt)
  
  status VARCHAR(20) DEFAULT 'COMPLETED', -- COMPLETED, IN_PROGRESS (for multi-step games), CANCELLED
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_casino_rounds_user ON casino_rounds(user_id);
CREATE INDEX idx_casino_rounds_game ON casino_rounds(game);
CREATE INDEX idx_casino_rounds_created ON casino_rounds(created_at);

-- User Seed Pairs
CREATE TABLE user_seeds (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) NOT NULL,
  server_seed VARCHAR(64) NOT NULL,
  server_seed_hash VARCHAR(64) NOT NULL,
  client_seed VARCHAR(64) NOT NULL,
  nonce INTEGER DEFAULT 0,
  revealed BOOLEAN DEFAULT false,
  revealed_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_user_seeds_user ON user_seeds(user_id);

-- Active Games (for multi-step games: mines, tower, hilo, blackjack)
CREATE TABLE active_casino_games (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) NOT NULL,
  game VARCHAR(50) NOT NULL,
  bet_amount DECIMAL(18,8) NOT NULL,
  current_multiplier DECIMAL(12,4) DEFAULT 1,
  game_state JSONB NOT NULL, -- current state (revealed tiles, cards, etc.)
  server_seed_hash VARCHAR(64) NOT NULL,
  client_seed VARCHAR(64) NOT NULL,
  nonce INTEGER NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(user_id, game) -- one active game per user per game type
);

-- Crash Game State
CREATE TABLE crash_rounds (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  round_number SERIAL,
  bust_point DECIMAL(12,4) NOT NULL,
  server_seed_hash VARCHAR(64) NOT NULL,
  status VARCHAR(20) DEFAULT 'WAITING', -- WAITING, RUNNING, CRASHED
  started_at TIMESTAMPTZ,
  crashed_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE crash_bets (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  round_id UUID REFERENCES crash_rounds(id),
  user_id UUID REFERENCES users(id),
  bet_amount DECIMAL(18,8) NOT NULL,
  bet_slot INTEGER DEFAULT 1, -- 1 or 2 (two bet slots)
  auto_cashout DECIMAL(12,4), -- null = manual
  cashed_out_at DECIMAL(12,4), -- multiplier when cashed out, null = busted
  payout DECIMAL(18,8) DEFAULT 0,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Jackpot Pool
CREATE TABLE jackpot_pool (
  id VARCHAR(20) PRIMARY KEY, -- 'mini', 'major', 'grand'
  current_amount DECIMAL(18,8) DEFAULT 0,
  seed_amount DECIMAL(18,8) DEFAULT 0,
  last_won_by UUID REFERENCES users(id),
  last_won_amount DECIMAL(18,8),
  last_won_at TIMESTAMPTZ,
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Casino Game Config (admin-managed)
CREATE TABLE casino_game_config (
  game VARCHAR(50) PRIMARY KEY,
  enabled BOOLEAN DEFAULT true,
  house_edge DECIMAL(5,2) DEFAULT 3.00,
  min_bet DECIMAL(18,8) DEFAULT 0.10,
  max_bet DECIMAL(18,8) DEFAULT 10000,
  max_payout DECIMAL(18,8) DEFAULT 100000,
  config JSONB DEFAULT '{}', -- game-specific config (e.g., crash speed, dice range)
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

## 24. IMPLEMENTATION ORDER

Build in this EXACT order:

### Phase 1: Core Engine
1. **ProvablyFairService** â€” seed generation, result generation, verification
2. **BaseGame class** â€” abstract game engine
3. **Database migrations** â€” all tables above
4. **Casino round recording** â€” audit trail for every bet
5. **API endpoints** â€” provably fair verification
6. **Fairness modal** â€” frontend verification UI

### Phase 2: Primary Games (5 Games)
7. **Crash** â€” MOST IMPORTANT: full multiplayer, canvas animation, auto-cashout
8. **Dice** â€” slider UI, over/under, multiplier calculation
9. **Mines** â€” 5Ã—5 grid, progressive reveal, cash-out
10. **Plinko** â€” physics animation (Canvas 2D), risk levels, row selection
11. **Coinflip** â€” 3D coin animation, simple 50/50

### Phase 3: Card Games (3 Games)
12. **Blackjack** â€” full rules, card animations, split/double/insurance
13. **HiLo** â€” card chain, progressive multiplier
14. **Baccarat** â€” standard rules, 3 bet types

### Phase 4: Additional Games (4 Games)
15. **Roulette** â€” spinning wheel, betting board, European rules
16. **Wheel of Fortune** â€” spinning wheel, segments
17. **Tower** â€” grid climbing, difficulty modes
18. **Limbo** â€” target multiplier, single number display

### Phase 5: More Games (3 Games)
19. **Keno** â€” number grid, draw animation
20. **Video Poker** â€” hold/draw, hand evaluation
21. **Slots** â€” reel spinning, paylines, symbol weights

### Phase 6: Systems
22. **Auto-bet system** â€” server-side auto-play for all games
23. **Jackpot system** â€” progressive pool, random trigger
24. **Live feed** â€” real-time bet feed across site
25. **Casino lobby** â€” game grid, categories, search

### Phase 7: Polish
26. **Sound effects** â€” win, lose, spin, click, big win (optional, use Howler.js)
27. **Animations** â€” confetti on big wins, screen shake, particle effects
28. **Mobile optimization** â€” all games playable on mobile
29. **Admin casino panel** â€” game management, stats, audit

---

## CRITICAL IMPLEMENTATION RULES

- **ALL randomness MUST use provably fair system** â€” never use Math.random()
- **ALL bets MUST be atomic transactions** â€” deduct balance â†’ play â†’ credit winnings
- **ALL rounds MUST be recorded** â€” casino_rounds table is the audit trail
- **House edge MUST be configurable per game** from admin panel
- **Multi-step games (Mines, Tower, HiLo, Blackjack) MUST track active state**
  - Only ONE active game per user per game type
  - If user disconnects mid-game: game stays active, they can resume
  - If server restarts: active games can be recovered from database
- **Crash game runs as a SHARED multiplayer room** â€” NOT per-user
  - One game loop, multiple players betting
  - Use Socket.IO rooms for crash game
- **ALL other games are SINGLE player** â€” individual rounds per user
- **Mobile: ALL games must work on 375px width**
  - Touch-friendly controls
  - No hover-dependent interactions
- **Canvas games (Crash, Plinko)** â€” use requestAnimationFrame, 60fps target
- **Card games** â€” use SVG or sprite sheet for card rendering
- **Auto-bet runs SERVER-SIDE** â€” prevents client-side manipulation

**Do NOT stop until ALL 15 games are implemented and working.**
**Do NOT ask questions. Build everything.**
